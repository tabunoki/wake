Wake
===============================================================================

Wake (we'ik) は [markdown][link_markdown] とテンプレート機能を持ったシンプルな CMS です。

Feature
-------------------------------------------------------------------------------

- markdown による HTML ファイルの静的生成
- テンプレート
- 変数のバインド
- ローカルサーバーでの表示確認
- ファイルのパージ（オプション）
- 更新日付の考慮（オプション）
- 一覧（オプション）



Usage
-------------------------------------------------------------------------------

### 実行

ダウンロードし解凍した Jar ファイルをコマンドプロンプトから実行します。

	java -jar wake.jar [options...] arguments...


### オプション

オプション無しで実行すると、オプション一覧が表示されます。

	java -jar wake.jar


ファイルの種別
-------------------------------------------------------------------------------

Wake ではファイルを以下の四つの分類で区別します。

### コンテンツファイル
拡張子が「.txt」のファイルをコンテンツファイルと見なします。
コンテンツファイルは、Markdown によってプレーンテキストから HTML へ変換され、
テンプレートファイルにキャストされて HTML になります。

### テンプレートファイル
拡張子が「.tmpl.html」のファイルをテンプレートファイルと見なします。
テンプレートファイルは言わばコンテンツを形作る鋳型で、窓に対する窓枠、絵画に対する額縁のようなものです。
コンテンツファイルはテンプレートファイルに収められて最終的な HTML になります。

### リソースファイル
上記二つのファイル以外をリソースファイルと見なします。
これらは、画像ファイル、CSS、などのコンテンツとテンプレート以外の、全てのファイルが該当し、
これらのファイルは単純にコピーされるだけです。

### ディレクトリ
ディレクトリはディレクトリとして見なします。
ビルドはディレクトリのツリー構造をまたがっているので、その構造を崩さないためにディレクトリをコピーします。


コンテンツ
-------------------------------------------------------------------------------

### ファイルの命名

単純です。
__.md__ の拡張子を付与するだけです。

たとえば、

	index.md

というファイルは、

	index.html

という HTML ファイルへ変換されます。
ファイルの中身は Markdown によって HTML へマークアップされます。
また、テンプレート識別子を記述することで、コンテンツをテンプレートの枠組みに組み込むことが出来ます。
テンプレート識別子は __@__ で記述します。

たとえば、

	index@default.md

というコンテンツファイルは default という名前のテンプレートを利用することを示しています。
このコンテンツファイルをビルドすると、

	index.html

となり、ファイル名はテンプレートを使う場合と使わない場合とで変わりませんが、
中身はテンプレートの枠組みに組み込まれたものになります。
テンプレートに関しては以降のチュートリアルで詳細に説明します。


### ファイルの内容

コンテンツの中身は、完全に Markdown および、MarkdownJ に準じます。
したがって、構文は Markdown の公式サイトを確認した方が早く正確に知ることが出来るでしょう。
あるいは、検索すれば、日本語の解説が手に入ります。

Markdown では直接 HTML を記述することが可能ですが、
残念ながら、意図する通りに完璧に取り扱えるとは限りません。
そもそも、直接記述する HTML の量があまり多い場合は、Markdown を利用している意義がありません。
例えば、HTML ファイルにはタイトルなどを記述する `<head>` タグなどがありますが、
これらのまとまった HTML はテンプレート化して共有した方が管理し易いでしょう。



テンプレート
-------------------------------------------------------------------------------

テンプレートとはコンテンツの共通部分を集約して管理し、共有して利用するためのものです。

### ファイルの命名

テンプレートを定義するには以下のようにファイルを命名します。

	default.tmpl.html

default はそのテンプレートのテンプレート名、
.tmpl.html はそのファイルがテンプレートファイルであることを表します。

### テンプレートを指定する

コンテンツファイルがテンプレートを利用するためには、
コンテンツファイルのファイル名にテンプレート識別子を指定します。

	index@default.txt

@ に続く、default が利用するテンプレートの名前になります。
なお、テンプレートファイルは利用するコンテンツファイルと同じディレクトリか、
あるいはそれよりも上位のディレクトリに配置する必要があります。


### テンプレートを継承する

コンテンツファイルにテンプレート識別子を指定できたように、テンプレートファイルにもテンプレート識別子を指定できます。

	default@super.tmpl.html

要領はコンテンツファイルがテンプレートファイルを利用するのと同じです。
ただし、テンプレートの継承では、継承される super.tmpl.html は、
継承する default@super.tmpl.html よりも、上位のディレクトリに配置しなければなりません。


### テンプレートファイルの内容

テンプレートの中身は基本的に HTML です。
テンプレートは Markdown によって変換されないので、Markdown の構文を記述しても意図した通りにはなりません。
そして、テンプレートには必ず以下の特殊なタグを、テンプレート内のどこかに記述する必要があります。

	<wake:body>

これは、このテンプレートを利用するコンテンツなりテンプレートなりの内容が、
このタグのある場所に挿入されることを表しています。



テンプレートタグ
-------------------------------------------------------------------------------

テンプレートタグはテンプレートの内容をコンテンツから決定する一種の変数のようなものです。

例えば次のようなテンプレートがあったとします。

	<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	
		<title>BuildWeb</title>
	
	</head>
	
	<body>
	
	<wake:body>
	
	</body>
	</html>

このテンプレートでは、
`<title>wake test</title>` とテンプレートでタイトルを定義しているため、
このテンプレートを利用する全てのコンテンツのタイトルが _wake test_ になります。
しかし、殆どの場合、ページごとに適切なタイトルを付けたいものです。
そんなときにテンプレートタグを利用します。

	<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	
		<title><wake:title></title>
	
	</head>
	
	<body>
	
	<wake:body>
	
	</body>
	</html>

注目すべき点は、`<title>wake test</title>` だった部分が、
`<title><wake:title></title>` になっているということです。
`<wake:title>` というテンプレートタグを記述することによって、
その定義をコンテンツファイルに委ねることが出来ます。


### 定義

テンプレートタグを記述するには以下の正規表現にマッチする必要があります。

	<wake:[a-z]+>

wake: に続きアルファベットの羅列で自由に定義できます。
ただし、数字や記号は使えません。
また、`<wake:body>` はすでに予約語となっており、これを使うことは出来ません。


### コンテンツ側の使用方法

例えば、コンテンツが先ほどのテンプレートを利用する場合、
`<wake:title>` の定義を委ねられているため、その内容をコンテンツで定義する必要があります。

	<wake:title>Tutorial</wake:title>

これによって、テンプレートの `<wake:title>` という記述が、_Tutorial_ に置き換わります。

記述はコンテンツのどこでもかまいませんが、必ず行頭に記述する必要があります。
また、テンプレートタグ内の記述はコンテンツではありますが、Markdown で変換されません。
テンプレートタグで HTML を定義したい場合は直接記述してください。



開発の経緯
-------------------------------------------------------------------------------
Wake を作ろうと思ったきっかけについて。

一般に普及している CMS は ZOOPS のようなポータルサイト管理や、
Movable Type、Wordpress のようなブログサイト管理が主流で、
CMS の原義に近いコンテンツ管理というコンパクトなシステムは、メジャーとなり得ませんでした。
おそらくそれは、コンテンツを管理するということが、ブログやポータルサイトとは違って明確な形態を持たないために、
個々が望む管理方法がバラバラで集約しなかったからだと思います。

要するに、しっくりくる CMS が無いのなら作ってしまおう、という考えから Wake を作りました。
なので、Wake の仕様はきわめてシンプルです。
それは、出来る限り、初歩的なウェブサイト管理の方法に即しつつ、テンプレートによって共有化できる部品を共有し、
コンテンツとマークアップを分割する、ということです。

作るにあたって [MakeWeb][link_makeweb] というツールに大きな影響を受けました。




License
-------------------------------------------------------------------------------
© 2013 Tabunoki

Distributed under the MIT License.



[link_markdown]: http://daringfireball.net/projects/markdown/
[link_markdownj]: http://markdownj.org/
[link_java]: http://java.com/ja/ "Javaの公式サイト"
[link_makeweb]: http://www.hyuki.com/makeweb/
